<template>
  <NuxtLayout>
    <div class="page-container">
      <div class="page-header">
        <h1>API Documentation</h1>
        <p>Complete guide to ClusterFox API endpoints and status indicators</p>
      </div>

      <!-- Navigation -->
      <div class="nav-pills">
        <button @click="activeTab = 'endpoints'" :class="{ active: activeTab === 'endpoints' }">
          API Endpoints
        </button>
        <button @click="activeTab = 'status'" :class="{ active: activeTab === 'status' }">
          Status Badges
        </button>
        <button @click="activeTab = 'examples'" :class="{ active: activeTab === 'examples' }">
          Code Examples
        </button>
      </div>

    <div class="api-docs" v-show="activeTab === 'endpoints'">
      <div class="card">
        <div class="card-header">
          <h2>Quick Start</h2>
          <span class="badge">v1.0</span>
        </div>
        <p>ClusterFox provides a RESTful API for managing IoT modules and collecting sensor data. All endpoints return JSON responses.</p>
        <div class="code-block">
          <div class="code-header">
            <span>Base URL</span>
            <button class="copy-btn" @click="copy('http://localhost:3000')">Copy</button>
          </div>
          <code>http://localhost:3000</code>
        </div>
      </div>

      <div class="card">
        <h2>Authentication</h2>
        <p>Modules authenticate using session IDs obtained during registration. Include the session_id in query parameters for authenticated requests.</p>
      </div>

      <div class="endpoint-card">
        <div class="endpoint-header">
          <span class="method get">GET</span>
          <h3>/api/register</h3>
        </div>
        <p class="endpoint-desc">Register a new module and receive a unique session ID for authentication.</p>

        <div class="endpoint-section">
          <h4>Parameters</h4>
          <table class="param-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>type</code></td>
                <td>string</td>
                <td>✅ Yes</td>
                <td>Module type (e.g., "temperature-sensor")</td>
              </tr>
              <tr>
                <td><code>umid</code></td>
                <td>string</td>
                <td>✅ Yes</td>
                <td>Unique module identifier</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="endpoint-section">
          <h4>Example Request</h4>
          <div class="code-block">
            <code>GET /api/register?type=temperature-sensor&umid=ESP32-001</code>
          </div>
        </div>

        <div class="endpoint-section">
          <h4>Example Response</h4>
          <div class="code-block">
            <pre>{{
  registerExample
}}</pre>
          </div>
        </div>
      </div>

      <div class="endpoint-card">
        <div class="endpoint-header">
          <span class="method get">GET</span>
          <h3>/api/pool</h3>
        </div>
        <p class="endpoint-desc">Submit sensor data from a registered module.</p>

        <div class="endpoint-section">
          <h4>Parameters</h4>
          <table class="param-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>session_id</code></td>
                <td>string</td>
                <td>✅ Yes</td>
                <td>Session ID from registration</td>
              </tr>
              <tr>
                <td><code>*</code></td>
                <td>any</td>
                <td>✅ Yes</td>
                <td>Additional sensor data parameters</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="endpoint-section">
          <h4>Example Request</h4>
          <div class="code-block">
            <code>GET /api/pool?session_id=abc123...&temperature=25.5&humidity=60</code>
          </div>
        </div>
      </div>

      <div class="endpoint-card">
        <div class="endpoint-header">
          <span class="method get">GET</span>
          <h3>/api/modules</h3>
        </div>
        <p class="endpoint-desc">Retrieve list of registered modules.</p>

        <div class="endpoint-section">
          <h4>Example Response</h4>
          <div class="code-block">
            <pre>{{
  modulesExample
}}</pre>
          </div>
        </div>
      </div>

      <div class="endpoint-card">
        <div class="endpoint-header">
          <span class="method get">GET</span>
          <h3>/api/sensor-data</h3>
        </div>
        <p class="endpoint-desc">Retrieve sensor data readings.</p>

        <div class="endpoint-section">
          <h4>Parameters</h4>
          <table class="param-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>session_id</code></td>
                <td>string</td>
                <td>No</td>
                <td>Filter by module session ID</td>
              </tr>
              <tr>
                <td><code>limit</code></td>
                <td>number</td>
                <td>No</td>
                <td>Max entries (default: 100)</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="endpoint-card danger">
        <div class="endpoint-header">
          <span class="method post">POST</span>
          <h3>/api/reset</h3>
        </div>
        <p class="endpoint-desc">⚠️ Reset entire database (delete all data).</p>
      </div>

      <div class="card">
        <h2>Arduino/ESP32 Example</h2>
        <div class="code-block">
          <pre>{{ arduinoExample }}</pre>
        </div>
      </div>


    </div>
    </div>
  </NuxtLayout>
</template>

<script setup>
const registerExample = `{
  "success": true,
  "message": "Module registered successfully",
  "session_id": "a1b2c3d4e5f6g7h8...",
  "umid": "ESP32-001",
  "moduleType": "temperature-sensor",
  "status": "new"
}`

const modulesExample = `{
  "success": true,
  "count": 2,
  "modules": [
    {
      "umid": "ESP32-001",
      "moduleType": "temperature-sensor",
      "status": "active",
      "dataCount": 150,
      "lastSeen": "2025-11-01T11:45:00.000Z"
    }
  ]
}`

const arduinoExample = `#include <HTTPClient.h>

// Register module
String umid = "ESP32-" + WiFi.macAddress();
String registerUrl = "http://server:3000/api/register?type=temperature-sensor&umid=" + umid;
HTTPClient http;
http.begin(registerUrl);
int httpCode = http.GET();
String sessionId = parseSessionId(http.getString());

// Send data
float temp = dht.readTemperature();
String dataUrl = "http://server:3000/api/pool?session_id=" + sessionId + "&temperature=" + String(temp);
http.begin(dataUrl);
http.GET();`

const copy = (text) => {
  navigator.clipboard.writeText(text)
  alert('✅ Copied to clipboard!')
}

const openFullDocs = () => {
  window.open('/API.md', '_blank')
}
</script>

<style scoped>
.page-container {
  padding: 2rem;
  max-width: 1000px;
  margin: 0 auto;
}

.page-header {
  margin-bottom: 2rem;
}

.page-header h1 {
  font-size: 1.875rem;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0 0 0.5rem 0;
}

.page-header p {
  font-size: 0.938rem;
  color: var(--text-secondary);
  margin: 0;
}

.api-docs {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.card, .endpoint-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
  animation: fadeInScale 0.4s ease;
}

.endpoint-card.danger {
  border-color: rgba(239, 68, 68, 0.3);
  background: rgba(239, 68, 68, 0.02);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.card h2, .endpoint-card h3 {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0 0 1rem 0;
}

.badge {
  padding: 0.25rem 0.625rem;
  background: var(--accent);
  color: black;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
}

.card p, .endpoint-desc {
  font-size: 0.875rem;
  color: var(--text-secondary);
  line-height: 1.6;
  margin: 0 0 1rem 0;
}

.code-block {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  margin: 1rem 0;
}

.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  background: rgba(0, 0, 0, 0.05);
  border-bottom: 1px solid var(--border);
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-secondary);
}

.copy-btn {
  padding: 0.25rem 0.5rem;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 0.688rem;
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: inherit;
}

.copy-btn:hover {
  background: var(--surface);
  color: var(--text-primary);
}

.code-block code, .code-block pre {
  display: block;
  padding: 1rem;
  font-family: 'Monaco', 'Courier New', monospace;
  font-size: 0.813rem;
  color: var(--text-primary);
  overflow-x: auto;
  margin: 0;
  line-height: 1.6;
}

.endpoint-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.75rem;
}

.method {
  padding: 0.375rem 0.625rem;
  border-radius: 6px;
  font-weight: 700;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.method.get {
  background: rgba(16, 185, 129, 0.1);
  color: #10b981;
}

.method.post {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
}

.endpoint-section {
  margin: 1.5rem 0;
}

.endpoint-section h4 {
  font-size: 0.938rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0 0 0.75rem 0;
}

.param-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.813rem;
}

.param-table th {
  text-align: left;
  padding: 0.75rem;
  background: var(--bg);
  font-weight: 600;
  color: var(--text-secondary);
  border-bottom: 1px solid var(--border);
}

.param-table td {
  padding: 0.75rem;
  border-bottom: 1px solid var(--border);
  color: var(--text-primary);
}

.param-table code {
  background: var(--bg);
  padding: 0.125rem 0.375rem;
  border-radius: 4px;
  font-family: 'Monaco', 'Courier New', monospace;
  font-size: 0.75rem;
}

.btn-primary {
  padding: 0.75rem 1.25rem;
  background: var(--accent);
  border: 1px solid var(--accent);
  border-radius: 8px;
  color: var(--bg);
  font-size: 0.875rem;
  font-weight: 600;
  font-family: inherit;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.2s ease;
  margin-top: 1rem;
}

.btn-primary:hover {
  background: transparent;
  color: var(--accent);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 255, 255, 0.15);
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
</style>
